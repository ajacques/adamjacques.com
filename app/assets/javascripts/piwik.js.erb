<% if Rails.env.assets? %>
(function() {
<%=
# WAT?
require 'net/http'
uri = URI.parse('https://raw.githubusercontent.com/piwik/piwik/master/js/piwik.js')
require 'net/https' if uri.scheme == 'https'

request = Net::HTTP::Get.new(uri.path)
http = Net::HTTP.new(uri.host, uri.port)
if uri.scheme == 'https'
  http.use_ssl = true
  http.verify_mode = OpenSSL::SSL::VERIFY_NONE # Don't hate me
end
http.request(request).body
%>
var _paq = _paq || [];
var url = '/monitor';
var id = document.getElementsByTagName('meta')['beacon_site_id'].content;
_paq.push(['setTrackerUrl', url]);
_paq.push(['setSiteId', id]);
_paq.push(['setCookiePath', '/monitor']);
_paq.push(['trackPageView']);
_paq.push(['enableLinkTracking']);
})();
<% end %>
